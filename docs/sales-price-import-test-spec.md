# 販売単価取込機能テスト仕様書

## 1. 概要

本テスト仕様書は、販売単価のExcelファイル取込機能のテスト方法を定義します。この機能は、指定されたフォーマットのExcelファイルから販売単価データを読み込み、システムに登録する機能です。

## 2. テスト環境

- テスト環境：開発環境
- テストデータ：テスト用Excelファイル（複数パターン）
- 前提条件：品目マスタ、得意先マスタが登録済みであること

## 3. テスト項目

### 3.1 正常系テスト

| No. | テスト項目 | 入力データ | 期待結果 | 確認ポイント |
|-----|------------|------------|----------|--------------|
| 1-1 | 基本的な取込 | 基本項目のみ設定したExcelファイル | 取込成功 | 全レコードが正しく登録されること |
| 1-2 | 数量スケール付き取込 | 数量スケール情報を含むExcelファイル | 取込成功 | 数量スケール情報も含めて正しく登録されること |
| 1-3 | 得意先指定なし取込 | 得意先コードを指定しないExcelファイル | 取込成功 | 標準価格として正しく登録されること |
| 1-4 | 複数レコード取込 | 複数レコードを含むExcelファイル | 取込成功 | 全レコードが正しく登録されること |
| 1-5 | 通貨コード指定取込 | 通貨コードを指定したExcelファイル | 取込成功 | 指定した通貨コードで登録されること |
| 1-6 | ステータス指定取込 | ステータスを指定したExcelファイル | 取込成功 | 指定したステータスで登録されること |

### 3.2 異常系テスト

| No. | テスト項目 | 入力データ | 期待結果 | 確認ポイント |
|-----|------------|------------|----------|--------------|
| 2-1 | 必須項目未設定 | 品目コード未設定のExcelファイル | エラーメッセージ表示 | 「品目コードは必須です」のエラーが表示されること |
| 2-2 | 必須項目未設定 | 基本価格未設定のExcelファイル | エラーメッセージ表示 | 「基本価格は必須です」のエラーが表示されること |
| 2-3 | 必須項目未設定 | 有効期間未設定のExcelファイル | エラーメッセージ表示 | 「有効期間は必須です」のエラーが表示されること |
| 2-4 | 不正な値 | 基本価格にマイナス値を設定したExcelファイル | エラーメッセージ表示 | 「基本価格は0以上の値を指定してください」のエラーが表示されること |
| 2-5 | 不正な値 | 有効終了日が有効開始日より前のExcelファイル | エラーメッセージ表示 | 「有効開始日は有効終了日より前の日付を指定してください」のエラーが表示されること |
| 2-6 | マスタ不整合 | 存在しない品目コードを指定したExcelファイル | エラーメッセージ表示 | 「品目コードが存在しません」のエラーが表示されること |
| 2-7 | マスタ不整合 | 存在しない得意先コードを指定したExcelファイル | エラーメッセージ表示 | 「得意先コードが存在しません」のエラーが表示されること |
| 2-8 | 数量スケール不正 | 数量範囲が重複するExcelファイル | エラーメッセージ表示 | 「数量範囲が重複しています」のエラーが表示されること |
| 2-9 | 数量スケール不正 | 数量範囲開始が0以下のExcelファイル | エラーメッセージ表示 | 「数量範囲開始は0より大きい値を指定してください」のエラーが表示されること |
| 2-10 | ファイル形式不正 | シート名が不正なExcelファイル | エラーメッセージ表示 | 「シート「販売単価」が見つかりません」のエラーが表示されること |
| 2-11 | ファイル形式不正 | ヘッダー行が不正なExcelファイル | エラーメッセージ表示 | 「必須ヘッダーが見つかりません」のエラーが表示されること |

### 3.3 期間重複テスト

| No. | テスト項目 | 入力データ | 期待結果 | 確認ポイント |
|-----|------------|------------|----------|--------------|
| 3-1 | 完全一致 | 既存データと期間が完全に一致するExcelファイル | 既存データが更新される | 既存データが新しい内容で更新されること |
| 3-2 | 期間内包含 | 既存データの期間内に収まるExcelファイル | 既存データが分割される | 既存データが分割され、新しいデータが挿入されること |
| 3-3 | 期間外包含 | 既存データの期間を包含するExcelファイル | 既存データが削除され新規登録 | 既存データが削除され、新しいデータが登録されること |
| 3-4 | 前方重複 | 既存データの前方と重複するExcelファイル | 既存データの期間が調整される | 既存データの開始日が調整され、新しいデータが登録されること |
| 3-5 | 後方重複 | 既存データの後方と重複するExcelファイル | 既存データの期間が調整される | 既存データの終了日が調整され、新しいデータが登録されること |

## 4. テスト手順

### 4.1 基本的な取込テスト

1. テスト用Excelファイルを準備する
2. システムにログインする
3. 販売単価取込画面に移動する
4. テスト用Excelファイルをアップロードする
5. 取込ボタンをクリックする
6. 取込結果を確認する
7. データベースに正しく登録されていることを確認する

### 4.2 異常系テスト

1. 異常データを含むテスト用Excelファイルを準備する
2. システムにログインする
3. 販売単価取込画面に移動する
4. テスト用Excelファイルをアップロードする
5. 取込ボタンをクリックする
6. エラーメッセージが正しく表示されることを確認する
7. エラー行が正しく特定されていることを確認する

### 4.3 期間重複テスト

1. 既存データと期間が重複するテスト用Excelファイルを準備する
2. システムにログインする
3. 販売単価取込画面に移動する
4. テスト用Excelファイルをアップロードする
5. 取込ボタンをクリックする
6. 取込結果を確認する
7. データベースのデータが期待通りに更新/分割/削除されていることを確認する

## 5. テストデータ

### 5.1 テスト用品目マスタ

| 品目コード | 品目名 |
|------------|--------|
| ITEM001 | テスト品目1 |
| ITEM002 | テスト品目2 |
| ITEM003 | テスト品目3 |

### 5.2 テスト用得意先マスタ

| 得意先コード | 得意先名 |
|--------------|----------|
| CUST001 | テスト得意先1 |
| CUST002 | テスト得意先2 |
| CUST003 | テスト得意先3 |

### 5.3 テスト用Excelファイル

各テスト項目に対応するExcelファイルを準備する。ファイル名は「販売単価取込_テスト項目No.xlsx」とする。

#### 5.3.1 基本テスト用ファイル（テスト項目1-1）

| 品目コード | 得意先コード | 基本価格 | 通貨コード | 有効開始日 | 有効終了日 | ステータス |
|------------|--------------|----------|------------|------------|------------|------------|
| ITEM001 | CUST001 | 1000 | JPY | 2023/01/01 | 2023/12/31 | ACTIVE |
| ITEM002 | CUST002 | 2000 | JPY | 2023/01/01 | 2023/12/31 | ACTIVE |

#### 5.3.2 数量スケール付きファイル（テスト項目1-2）

| 品目コード | 得意先コード | 基本価格 | 通貨コード | 有効開始日 | 有効終了日 | ステータス | 数量範囲開始1 | 数量範囲終了1 | スケール価格1 | 数量範囲開始2 | 数量範囲終了2 | スケール価格2 |
|------------|--------------|----------|------------|------------|------------|------------|---------------|---------------|--------------|---------------|---------------|--------------|
| ITEM001 | CUST001 | 1000 | JPY | 2023/01/01 | 2023/12/31 | ACTIVE | 10 | 50 | 900 | 51 | 100 | 800 |

## 6. 判定基準

- 正常系テスト：全てのテスト項目が期待通りの結果となること
- 異常系テスト：適切なエラーメッセージが表示され、エラー行が正しく特定されること
- 期間重複テスト：既存データが期待通りに処理されること

## 7. 注意事項

- テスト実施前に、テストデータベースをリセットすること
- テスト実施後は、テスト結果を記録すること
- 発見された不具合は、詳細な再現手順とともに報告すること

## 8. テスト実施記録

| テスト項目No. | 実施日 | 実施者 | 結果 | 備考 |
|---------------|--------|--------|------|------|
|               |        |        |      |      | 